!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("jquery")):"function"==typeof define&&define.amd?define(["exports","jquery"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).pragmaThread={})}(this,(function(t){"use strict";function e(t,e=null,n=["rerun the code 10 times"],r=null,i=!1){if(!S()&&!i)return null;console.error(`%c ðŸ§¯ pragma.js  %c \n\n      encountered a soft error ðŸ”« %c \n\n      \n${r?`Triggered by: [${r.key} ${r}]`:""}\n      \n${t} %c\n\n      \n${null!=e?`Potential ${e}: \n\t${n.join("\n\t")}`:""}\n      `,"font-size:15px","font-size: 12px;","color:whitesmoke","color:white")}function n(){if(!S())return null;console.log(...arguments)}function r(){if(!S())return null;console.log("%c ðŸŒ´ [pragma] \n\n      ","font-size:12px; color:#86D787;",...arguments,"\n")}class i{constructor(t){this.self=t,this.actions=new Map,this.delete=this.destroy}addWithKey(t,e=null){return e=e||this.actions.size,this.actions.set(e,t),e}add(...t){let e=[];for(let n of t)e.push(this.addWithKey(n));return e.length>1?e:e[0]}forAction(t){for(let[e,n]of this.actions)t(e,n)}exec(...t){this.execAs(this.self,...t)}destroy(...t){t.forEach((t=>this.actions.delete(t)))}execAs(t,...e){this.forAction(((n,r)=>{let i=null;i="function"==typeof r.bind?r.bind(t)(...e):r(...e),"function"==typeof i&&i({key:n,action:r,replaceWith:t=>{},selfDestruct:()=>{this.destroy(n)}})}))}}function s(){return Math.random().toString(36).substring(3,6)+Math.random().toString(36).substring(5,8)}function o(){return a(8)}function a(t=7){return t<5?s():(s()+a(t-5)).substring(0,t)}function h(t){return a(t)}function l(t,e){for(let[n,r]of Object.entries(e))t[n]=r;return t}const c=t=>t.replace(/([-_]\w)/g,(t=>t[1].toUpperCase()));function u(t,e){let n=`${t}Chain`,r=`on${t.capitalize()}`;return e[n]=new i(e),e[r]=function(t,r){e[n].addWithKey(t,r)},{chainName:n,eventName:r}}function d(t,...e){for(let n of e)u(n,t)}function f(t,e){let n=u(t,e),r=`is${t.capitalize()}ed`;e[n.chainName].add((()=>{e[r]=!0})),e[n.eventName]=function(t){if(e[r])return t(e);e[n.chainName].add(t)}}function p(t,...e){for(let n of e)f(n,t)}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};const g=t=>t.toString().replace(/[^a-z0-9]/gi,"-").toLowerCase();globalThis.pragmaSpace||(globalThis.pragmaSpace={}),p(globalThis.pragmaSpace,"docLoad");const m=globalThis.pragmaSpace.onDocLoad;function y(){globalThis.pragmaSpace.isDocLoaded||(r("ðŸ“° document is loaded."),globalThis.pragmaSpace.docLoadChain.exec())}"complete"===document.readyState?y():(document.addEventListener("readystatechange",(()=>{"complete"===document.readyState&&y()})),document.addEventListener("turbolinks:load",(()=>{r("ðŸš€ TURBOLINKS loaded"),y()})));var x=/[#.]/g;function v(t,e="div"){var n=t||"",r={tag:e},i=0;let s,o,a;for(;i<n.length;)x.lastIndex=i,a=x.exec(n),s=n.slice(i,a?a.index:n.length),s&&(o?"#"===o?r.id=s:r.class?r.class.push(s):r.class=[s]:r.tag=s,i+=s.length),a&&(o=a[0],i++);return r}function b(t,n,r){if(!Array.isArray(t))return e(`Could not ${r} class [${t}] -> [${n}]`);for(let e of t){let t=e.split(" ");t.length>1?b(t,n,r):n.classList[r](e)}}function _(t,e){b(t,e,"add")}function $(t,e){b(t,e,"remove")}function C(t,e){b(t,e,"toggle")}function k(t){t=t.trim();try{let e=document.querySelector(t);if(e)return e}catch{}let e=v(t),n=document.createElement(e.tag||"div");return e.id&&(n.id=e.id),e.class&&_(e.class,n),n}function w(t){return document.createRange().createContextualFragment(t)}function E(t){return t instanceof Element?t:"string"==typeof t?"<"===t[0]?w(t):k(t):e(`Could not find/create element from [${t}]`)}const T={html:(t,e)=>{e.innerHTML=t},pcss:(t,e)=>{for(let[n,r]of A.cssToDict(t))e.style[c(n)]=r}},A={cssToDict:t=>{t=t.replace(/\n/g,";").replace(/:/g," ");let n=new Map;for(let e of t.split(";")){if(e.replace(/\s/g,"").length<2)continue;e=e.trim().split(" ");let t=e[0];e.shift(),n.set(t.trim(),e.join(" ").trim())}let r=[];for(const[t,e]of n.entries())CSS.supports(t,e)||r.push(`${t.trim()}: ${e.trim()}`);return r.length>0&&e("CSS syntax error","typos",r),n},css:t=>{let e="";for(let[n,r]of A.cssToDict(t))e+=`${n}:${r};`;return e},html:t=>t};function S(){return globalThis.pragmaSpace.dev}globalThis.pragmaSpace||(globalThis.pragmaSpace={}),globalThis.pragmaSpace.dev=globalThis.pragmaSpace.dev||"undefined"!=typeof process&&process.env&&"development"===process.env.NODE_ENV;var M=Object.freeze({__proto__:null,_deving:S,throwSoft:e,log:n,suc:r,whenDOM:m,parseQuery:v,addClassAryTo:_,removeClassAryFrom:$,toggleClassAryOf:C,selectOrCreateDOM:k,elementFrom:E,toHTMLAttr:g,fragmentFromString:w,fillSVG:function(t,e){j(t).findAll("path").forEach((t=>{const n=t.attr("fill");"none"!=n&&"transparent"!=n&&t.attr("fill",e)}))},generateRandomKey:h,objDiff:l,aryDiff:function(t,e){return t.filter((t=>e.indexOf(t)<0))},_extend:function(t,e){Object.setPrototypeOf(t,l(Object.getPrototypeOf(t),e))},overwrite:function(t,e,n){let r=t[e];t[`_${e}`]=r.bind(t),t[e]=n},createEventChains:p,createChains:d,snake2camel:c,mimic:function(t,e,n){for(let r of n||Object.keys(e)){let n=Object.getOwnPropertyDescriptor(e,r);if(!n)break;Object.defineProperty(t,r,n)}},bench:function(t,e){console.time(e),t(),console.timeEnd(e)},addStyles:function(t,e="injected-pragma-style"){j(`style#${e}-${s()}`,t).appendTo("head")},rk:a,rk5:s,rk8:o,parse:A,apply:T,createTemplate:t=>(new W).run((function(){d(this,"config"),this.config=function(t){return this.configChain.exec(t),this},this.onConfig(((t={})=>{["events","chains","exports","persistentExports"].forEach((e=>{t[e]&&(this[`_${e}`]=t[e],delete t[e])})),this._events&&p(this,...this._events),this._chains&&d(this,...this._chains);for(let[e,n]of Object.entries(t))this[e]=n,this.export(e);this._exports&&this.export(...this._exports)})),this.export("exports","config","exportChain","configChain","onConfig")}),(function(){"object"==typeof t&&this.config(t)}))});function O(t){return null==t||null==t?e(`Could not find a DOM element for ${t}`):t.element?O(t.element):E(t)}function j(t,e){let n=O(t);var r,i;return n.constructor===DocumentFragment&&(r=n,(i=document.createElement("template")).appendChild(r.cloneNode(!0)),n=i.firstChild),n instanceof Element&&(n.init(),n._render()),"string"==typeof e&&n.html(e),n}const L={init:function(){this.isPragmaElement=!0,p(this,"docLoad","render"),m((()=>this.docLoadChain.exec(this)))},_render:function(){this.renderChain.exec(this)},appendTo:function(t){return this.onDocLoad((()=>{this._parentElement=O(t),this._parentElement.appendChild(this),this._render()})),this},prependTo:function(t){return this.onDocLoad((()=>{this._parentElement=O(t),this._parentElement.prepend(this),this._render()})),this},append:function(...t){return this.onRender((()=>{for(let e of t){let t=O(e);this.appendChild(t)}})),this},destroy:function(){this.onRender((()=>{this.parentElement&&this.parentElement.removeChild(this)}))},css:function(t){return this.onRender((()=>{T.pcss(t,this)})),this},setText:function(t){return t?(this.onRender((()=>{this.textContent=t})),this):this.text},html:function(t){return t?(this.onRender((()=>{T.html(t,this)})),this):this.innerHTML},setId:function(t){return this.id=t,this},setData:function(t){for(let[e,n]of Object.entries(t))this.dataset[e]=n;return this},getData:function(t){return this.dataset[t]},addClass:function(...t){return _(t,this),this},removeClass:function(...t){return $(t,this),this},toggleClass:function(...t){return C(t,this),this},listenTo:function(...t){return this.onRender((()=>{this.addEventListener(...t)})),this},attr:function(t,e){if("string"==typeof t){if(void 0===e)return this.getAttribute(t);const n=t;(t={})[n]=e}for(let[e,n]of Object.entries(t))this.setAttribute(e,n);return this},find:function(){return j(this.query(...arguments))},findAll:function(t){return Array.from(this.queryAll(t)).map((t=>j(t)))},query:function(){return this.querySelector(...arguments)},queryAll:function(t){return this.querySelectorAll(t)},hide:function(){return this.style.display="none",this},show:function(){return this.style.display="",this},deepQueryAll:function(t){let e=Array.from(this.queryAll(t));for(let n of this.children)e=e.concat(n.deepQueryAll(t));return e},deepFindAll:function(t){return this.deepQueryAll(t).map((t=>j(t)))},rect:function(){return"function"==typeof this.getBoundingClientRect?this.getBoundingClientRect():{}},offset:function(t){t&&["width","height","left","right","top","bottom"].forEach((e=>{e in t&&(this.style[e]=t[e]+"px")}));var e=this.rect();return{top:e.top+window.scrollY,left:e.left+window.scrollX}},x:function(t){return this.left+this.width/2-t/2}},D={top:function(){return this.offset().top},left:function(){return this.offset().left},width:function(){return this.rect().width},height:function(){return this.rect().height},text:function(){return this.textContent},classArray:function(){return Array.from(this.classList)},childrenArray:function(){return Array.from(this.children)}};for(let[t,e]of Object.entries(L))Element.prototype[t]=e;for(let[t,e]of Object.entries(D))Object.defineProperty(Element.prototype,t,{get:e,configurable:!0});class R{constructor(t){this._childMap=new Map,this.key="string"==typeof t?t:o(),this.containsKey=this.childMap.has}set childMap(t){for(let[e,n]of t)n instanceof R&&this.add(n)}get childMap(){return this._childMap}get kidsum(){return this.childMap.size}get hasKids(){return this.kidsum>0}get shape(){return this.shapePrefix()}get master(){return null==this.parent||null==this.parent.parent?this.parent:this.parent.master}get children(){return Array.from(this.childMap.values())}get depthKey(){return this.parent?this.parent.depthKey+"<~<"+this.key:this.key}get allChildren(){if(!this.hasKids)return null;let t=this.children;for(let e of t){let n=e.allChildren;n&&(t=t.concat(n))}return t}get(t){return this.childMap.get(t)}find(t){if(this.childMap.has(t))return this.childMap.get(t);for(let e of this.childMap.values()){let n;try{n=e.find(t)}catch{}if(n)return n}}adopt(...t){for(let e of t)this.add(e);return this}add(t,n=!1){return t?!n&&this.childMap.has(t.key)?(t.key=`${t.key}<${s()}`,this.add(t)):(t.parent=this,void this.childMap.set(t.key,t)):e(`Could not add [${t}] to [${this.id}]`)}delete(t){return this.remove(t)}remove(t){this.childMap.get(t)&&this.childMap.delete(t)}shapePrefix(t=""){let e=`${t}| ${this.type} - ${this.key} \n`;if(this.hasKids){t+="| ";for(let n of this.children)e+=n.shapePrefix(t)}return e}}const N={parent:(t,e)=>{t.parent=e},value:(t,e)=>{t.value=e},key:(t,e)=>{t.key=e},class:(t,e)=>{t._class=e},element:(t,n)=>{if(!(n instanceof Element))return e(`Could not add ${n} as the element of [${t}]`);t.element=n},children:(t,e)=>{if(e.constructor==Array)return t.buildAry(e);t.build(e)},childTemplate:(t,e)=>{}};function P(t,e){return{val:t,set:e}}function z(t,e){return t=e.min?Math.max(e.min,t):t,e.max?Math.min(e.max,t):t}function K(t,n){return function(t){return t&&null!=t.min&&null!=t.max}(n)?(null==t&&(t=n.min),t=(t=t>n.max?n.min:t)<n.min?n.max:t):e(`Could not loop value, since range (${JSON.stringify(n)}) is unbounded`)}class W extends R{constructor(t,e){super(),p(this,"export"),this.actionChain=new i,this._events=new Map,"object"==typeof t?function(t,e){let n=new Map;for(let[r,i]of Object.entries(t))N.hasOwnProperty(r)?N[r](e,i):n.set(r,i);e.element&&e.element.whenInDOM((t=>{for(let[r,i]of n)if(r=r.toLowerCase(),r.includes("on")){let n=r.split("on")[1].trim();t.listenTo(n,(()=>{e.action(i)}))}}))}(t,this):this.key=t,this.element||this.as()}listenTo(t,e){return this.element.listenTo(t,e.bind(this)),this}_addToEventChain(t,...e){let n=this._events.get(t);if(n){let r=n.add(...e);return this._events.set(t,n),r}return null}createEvent(t,...e){let n=new i(this);return this._events.set(t,n),e.length>0&&this.on(t,e),this}createEvents(...t){return t.forEach((t=>{this.createEvent(t)})),this}triggerEvents(t,...e){return t.forEach((t=>{this.triggerEvent(t,...e)})),this}triggerEvent(t,...e){return this._events.has(t)?(this._events.get(t).execAs(this,...e),this):M.throwSoft(`pragma doesnt have ${event} - cannot .triggerEvent("${event}")]`,this)}_on(t,...e){let n=this._addToEventChain(t,...e);return null===n?M.throwSoft(`pragma doesnt have ${t} - cannot .on("${t}")`,this):n}on(){return this._on(...arguments),this}_onNext(t,e){this._on(t,(function(){return e(...arguments),t=>{t.selfDestruct()}}))}onNext(){return this._onNext(...arguments),this}createWires(...t){return t.forEach((t=>this.createWire(t))),this}createWire(t){let e={change:`${t}Change`,set:`${t}Set`};return this.createEvents(e.change,e.set),Object.defineProperty(this,t,{set:n=>{let r=function(t,e,n){if(n)return P(K(t,n),!0);if(e){let n=z(t,e);return P(n,n===t)}return P(t,!0)}(n,this[`_${t}Range`],this[`_${t}Loop`]);const i=this[`_${t}`];r.set&&r.val!==i&&(this[`_${t}`]=r.val,this.triggerEvent(e.change,r.val,i)),this.triggerEvent(e.set,n,i)},get:()=>this[`_${t}`]}),this[`set${t.capitalize()}`]=e=>(this[`${t}`]=e,this),this[`set${t.capitalize()}Silently`]=e=>(this[`_${t}`]=e,this),this[`set${t.capitalize()}Loop`]=(e,n)=>(this[`_${t}Loop`]={min:e,max:n},this),this[`set${t.capitalize()}Range`]=(e,n)=>(this[`_${t}Range`]={min:e,max:n},this),this}get _e(){return this.element}setElement(t,e=!0){return this.elementDOM=t,e&&this.element.id&&(this.id=this.element.id),this}get element(){return this.elementDOM}set element(t){this.setElement(t)}setRange(t=null,e=null){return this.range=this.range||{},this.range.min=null===t?this.range.min:t,this.range.max=null===e?this.range.max:e,this}breakLoop(){return this._loopVal=!1,this}setLoop(t,e){return this.setRange(t,e),this._loopVal=!0,this}get dv(){return this.v-this._lv}get value(){return this.v}setValue(t){return this.value=t,this}set value(t){let e=function(t,e,n){if(!e)return P(t,!0);if(n)return P(K(t,e),!0);let r=z(t,e);return P(r,r==t)}(t,this.range,this._loopVal);e.set&&(this._lv=this.v,this.v=e.val,this.exec())}exec(){return this.actionChain.execAs(this,...arguments),this}setKey(t){return this.key=t,this}set key(t){this._KEY=null==t?h():t}get key(){return this._KEY}set id(t){this.element&&(this.element.id=this.id)}get id(){return g(this.key)}buildAry(t){for(let e of t)this.add(new W(e,this));return this}build(...t){return this.buildAry(t)}as(t=null,e){return t=t||`div#${this.id}.pragma`,this.setElement(j(t,e),!1),this}addExport(t){this.exports=this.exports||new Set,this.exports.add(t)}export(...t){for(let e of t)this.addExport(e)}import(...t){let e=new i;for(let n of t)"function"==typeof n&&(n=n()),n.exports&&M.mimic(this,n,n.exports),n.exportChain&&e.add((t=>{n.exportChain.exec(this)}));return e.exec(),this}from(t){return t.exports&&M.mimic(this,t,t.exports),t.exportChain&&t.exportChain.exec(this),this}wireTo(t){let e=this;return t.do((function(){e.value=this.value})),this}do(){return this.actionChain.add(...arguments),this}extend(t,e){return M.overwrite(this,t,e),this}define(...t){for(let e of t){if(!e.name)return console.error("could not define, no name passed",e);this[e.name]=e}return this}run(...t){let n=t[0];return"function"==typeof n?this._runAry(t):"object"==typeof n?this._runAry(Object.values(n)):e(`Could not run [${t}] as [${this}]`),this}_runAry(t){for(let e of t)this.runAs(e)}runAs(t){return t.bind(this)()}containAry(t,n="append"){for(let r of t)super.add(r),r.isRendered?e(`[${r}] is already appended`):this.element[n](r);return this}contain(...t){return this.containAry(t)}containFirst(...t){return this.containAry(t.reverse(),"prepend")}pragmatize(){return this.element.appendTo(this.parent&&this.parent.element||"body"),this}pragmatizeAt(t){return this.element.appendTo(t),this}addListeners(t){for(let[e,n]of Object.entries(t))this.on(e).do(n);return this}}const q=["html","css","addClass","removeClass","toggleClass","setId","append","prepend","appendTo","prependTo","setData"];for(let t of q)W.prototype[t]=function(){return this.element[t](...arguments),this};const F=["getData"];for(let t of F)W.prototype[t]=function(){return this.element[t](...arguments)};const B=["offset","text","top","left","width","height","x","classArray"];for(let t of B)Object.defineProperty(W.prototype,t,{get:function(){return this.element[t]}});globalThis.pragmaSpace||(globalThis.pragmaSpace={}),globalThis.pragmaSpace.integrateMousetrap=function(t){"function"==typeof t&&(W.prototype.bind=function(e,n,r){let i=this;return t.bind(e,(function(){return i.runAs(n)}),r),this},globalThis.pragmaSpace.mousetrapIntegration=!0,r("Mousetrap configuration detected! Extended Pragmas to support .bind() method!"))};try{globalThis.pragmaSpace.integrateMousetrap(Mousetrap)}catch(t){n("Tried to integrate extensions, but failed. To disable,\n  this attempt: globalThis.pragmaSpace.integrate3rdParties = false")}class I extends W{constructor(t=4){super(),this.fnMap=new Map,this._maxWorkers=t}run(t){let e=this.fnMap.get(t);return console.log(e),e.execute(t)}getAvalaibleWorker(t){return this._workers>this._maxWorkers?console.error("max amount of workers reached"):function(){return new V(...arguments)}(t)}createFn(t){this.fnMap.set(t.name,this.getAvalaibleWorker(t))}define(...t){for(let e of t)this.createFn(e),this[e]=()=>this.run(e);return this}}class V extends W{constructor(...t){super(),this._blocks=new Map,this._executes=0,this.addBlocks(...t),this.createEvents("message","error")}execute(t,...e){let n=this._executes;return this.worker.postMessage(JSON.stringify({key:n,name:t,args:e})),this._executes+=1,new Promise(((t,e)=>{this.on("message",(e=>{if(console.log("received",e),e.key===n)return console.log(n,e),t(e.data),t=>t.selfDestruct()}))}))}addBlocks(...t){for(let e of t)e.name?this._blocks.set(e.name,e):console.error("could not add withoout a name",e);this.spawnWorker()}spawnWorker(){let t="fns = {";for(let[e,n]of this._blocks)t+=`${e}: ${n.toString()},`;return t+="};\nfunction respond(key, data) {\n    postMessage(JSON.stringify({\n        key,\n        data\n    }))\n}\n\nonmessage = async (_data) => {\n    let data = _data.data\n\n    data = JSON.parse(data)\n    let key = data.key\n\n    if (!_data.isTrusted) respond(key, 500)\n    let fn = fns[data.name]\n    if (!fn) respond(key, 404)\n\n    let result = await fn(...data.args)\n    respond(key, result)\n}\n",this.worker=function(t){const e=new Blob([t.toString()],{type:"application/javascript"});return new Worker(URL.createObjectURL(e))}(t),this.worker.onmessage=t=>{if(!t.isTrusted)return console.error("data not trusted");this.triggerEvent("message",JSON.parse(t.data))},this.workeer}}t._thread=function(){return new I(...arguments)},Object.defineProperty(t,"__esModule",{value:!0})}));
